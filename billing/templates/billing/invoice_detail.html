{% extends 'base.html' %} {% block content %}

<div class="mb-4">
  <h2>Invoice #{{ invoice.id }}</h2>

  <p class="mb-1"><strong>Client:</strong> {{ invoice.client.name }}</p>
  <p class="mb-1">
    <strong>Project:</strong> {{ invoice.project|default:"-" }}
  </p>
  <p class="mb-1">
    <strong>Status:</strong
    ><span
      class="badge {% if invoice.status == 'paid' %}bg-success{% else %}bg-secondary{% endif %}"
    >
      {{ invoice.get_status_display }}</span
    >
  </p>
  <p class="mb-1"><strong>Due Date:</strong> {{ invoice.due_date }}</p>
</div>

<hr />

<h4>Line Items</h4>

<table class="table table-sm">
  <thead>
    <tr>
      <th>Description</th>
      <th class="text-end">Qty</th>
      <th class="text-end">Unit Price</th>
      <th class="text-end">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{item.description}}</td>
      <td class="text-end">{{item.quantity}}</td>
      <td class="text-end">R{{item.unit_price}}</td>
      <td class="text-end">R{{item.total}}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4" class="text-muted">No line items</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr />

<div class="d-flex justify-content-end">
  <h4>Total: R{{ invoice.total_amount|floatformat:2 }}</h4>
</div>

{% if request.user.profile.role == 'admin' and invoice.status != 'paid' %}
<form method="post" action="{% url 'invoice_mark_paid' invoice.pk %}">
  {% csrf_token %}
  <a
    href="{% url 'invoice_update' invoice.pk %}"
    class="btn btn-outline-primary"
    >Edit</a
  >
  <button class="btn btn-success">Mark as paid</button>
  <a href="{% url 'invoice_delete' invoice.pk %}" class="btn btn-outline-danger"
    >Delete</a
  >
</form>
{% endif %} {% endblock %}
